# 5 프로듀서의 내부 동작 원리와 구현

- 프로듀서가 전송하는 메세지들은 send() 메소드를 통해 시리얼라이저 - 파티셔너 - 카프카로 전송된다

## 5.1 파티셔너

- 카프카 토픽은 병렬 처리 지원을 위해 최소 하나 / 둘 이상의 파티션으로 구성
  - 메세지 전송 후 해당 파티션의 로그 세그먼트에 저장
- 메세지를 보낼 때 토픽 파티션을 결정하는 역할
- 메세지 키를 해시처리, 비교
  - 키가 같다면 같은 파티션으로 결정
- 메세지가 많아질 경우 카프카는 토픽의 파티션을 늘림
  - 파티션 수가 변하면서 메세지 키 해시 테이블도 변경
  - 파티션이 추가될 경우 같은 메세지라도 다른 파티션에 저장될 수 있음

### 5.1.1 라운드 로빈 전략

- 메세지 키 값을 정하지 않을 경우 프로듀서는 라운드 로빈 전략으로 파티션을 지정
  - 프로듀서의 버퍼에 대기하는 과정에서 라운드로빈은 비효율적일 수 있음
- 배치 전송을 위해 버퍼에 대기하는 동안 라은드로빈으로 인해 버퍼가 차지 않을 수 있음

### 5.1.2 스티키 파티셔닝 전략

- 라운드 로빈의 비효율적인 전송을 보완하기 위해 등장
- 하나의 파티션에 레코드 수를 먼저 채워 빠르게 전송
